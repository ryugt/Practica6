from sympy import mod_inverse
from gmpy2 import iroot
import math

# Datos N
N = [
    156347688102726454823889416472453769630029897853512166254687777486075063031423183676252895347432482500241946689013358855470486673169586930678111085911649116120388122215781545716642791931518186610854646243628090444213625898861906056515185507685253458803609826204999300235298709231490589094202247797312708961907, 
    117848142580767301479140610710350191400363802862119303486145436424386403651945506124604731078881678785302566535894067779696338606654375587912054236667905745167180779541914821605115675550265348648694791854824634994884784098347860611336863256025292645012883471253871196440185889342884709931056940458285831881759, 
    160840782788886869832552217679031227306145298760248558604239324564642932511809556758723771493024027652356917672632695677849531127766622621206334981013367305231061396447089403731525465581041597768882342165534924271303668908582936231000186385983869381704613464423017749139940223866684432378537046831053915159771, 
    109572690095833540015177630428364938495950572655072149382179286384922852732906777196360212411251388705330226247771356213394179053422433827490965557757599881601396359035094633961986603390874697313171100402004246306710761908700692386929283300038933941891301836103671930246156416077878801122403583579122661211123, 
    141701375513385166436096856851870377569757196618323301515474561851963944201553892806385634685979719434134626892867514566869672175318054795127061123136343151046388750768853585184965464447778660441245369717291925456813496616014316315880303824874971158040757712062942215019738814733157445385148149570670759906769
    ]  # Módulos de las 5 claves públicas
C_hex = [
    "93B2F23D212AD4FE2B8AF2CF095ACCF51D40A49E228A46DB124EE48951560755BB0947E49709FD7C323721B9C75A1A420BAAFD454E13C4C972A7AA6A6F30924E688CE9B661B104E6CF2B06CD38EEFDD75F1DAFA7BF37E41D1CED96B1D6A756CD8DD15E1B481266EBEC5AB228562825E181513F35D1083D776CC805F748A280DE", 
    "629A73AB9C2E984540C0E6E51F9B511102188360F1189703E14C6256AE337FEDC99586B270E6CAAF806AC834260E3C6ACBCD20BB4BC7AAACDA740A0E3063AFBD475C6DEAC370303C6C6FDCC7CC0E4F0EC2032D0EAD1A84A7955AA6E0299DD57043F6B056D00796F60F3249B2824247CCA68D70AA8F6E0693AF23AD8EDD95D627", 
    "78DF06A6E6A828630DF0E51E67FC0F4F7095BBE0B03FD1790901C2D167ADD01E08452A2E7F5E41C4120C18B0CDE3A23C38407BAF3452C23CECF6D2B63ED677A92931E435FA9F52D7762F31125AEEFEC7317DFC6D3B7124278825A54EF09CD1552A9FC22EE41D77FDF01FDF595DB808E55FD73EE62C11F83868A3942459276707", 
    "0DEE7FEACC216E79AF3E5A33014655912EF8A6B3B95F991E5440117C05E43AB23786CD3FC8960D4B33308A1E83050552D02160DEAB7495F2323ACF8F8BF0EB917D7EC848C07CA13F7DA00C7D70C7ABE53FF58F36D000F62954E029E5DEEA2BD376317CF67E31DFDD1FE8D8FDE422826BB0E6430C9653D5CE30FC1FBC127BB3EE", 
    "B68697D66DD835BAC0AFD070D47B7C04A31782FFFC24B312EAC3EE2BB9DD30B096CE73CDCFD1946689387A5C8A674CEFF98AC5D3E961DC1BC1A62D3FA91DBC891A350A7F44F24EAB9DA91A7AAC4198A18BC76F487C1DC5E4C99BF38434BE9C52CDB28B83E587E1D88A991260571D0923E2C30DEFA497ABD76D3B7A28166A7D80"]
C = [int(c, 16) for c in C_hex]
#print("C: ", C)

# 1. Calcular el producto de todos los módulos
N_total = math.prod(N)

# 2. Aplicar el Teorema del Resto Chino (CRT)
C_combined = 0
for i in range(5):
    Ni = N_total // N[i]  # Calcular N_total / N_i
    inv_Ni = mod_inverse(Ni, N[i])  # Inverso modular
    C_combined += C[i] * Ni * inv_Ni  # Aplicar CRT

C_combined %= N_total  # Reducir módulo N_total

# 3. Calcular la raíz quinta de C_combined para obtener M
M, exact = iroot(C_combined, 5)  # Raíz quinta entera

if exact:
    print(f"Mensaje original: {M}")


M_hex = hex(M)[2:]  # Convertir a hexadecimal quitando el "0x"
print(f"Mensaje en hexadecimal: {M_hex}")


